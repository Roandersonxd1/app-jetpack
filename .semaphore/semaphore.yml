version: v1.0
name: Android
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
    task:
      jobs:
        - name: 'Build Project'
          commands:
            - ./gradlew bundle
      epilogue:
        on_pass:
          commands:
            - cache clear
            - cache store gradle-wrapper ~/.gradle/wrapper
            - cache store gradle-cache ~/.gradle/caches
            - cache store android-build ~/.android/build-cache

  - name: 'Verification'
    task:
      jobs:
        - name: 'Analyze Code'
          commands:
            - ./gradlew lint
        - name: 'Unit Tests'
          commands:
            - ./gradlew test